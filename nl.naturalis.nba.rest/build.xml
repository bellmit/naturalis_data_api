<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="."
         name="nl.naturalis.nba.rest"
         xmlns:naturalis="antlib:nl.naturalis.ant.contrib">

	<import file="../nl.naturalis.nba.build/common.xml" />
	<import file="../nl.naturalis.nba.build/modules.xml" />

	<!-- Project dependencies and non-Ivy-managed dependencies -->
	<path id="non-ivy-dependencies">
		<filelist dir="${api.module.location}/build" files="${api.module.artifact}" />
		<filelist dir="${common.module.location}/build"
		          files="${common.module.artifact}" />
		<filelist dir="${dao.module.location}/build" files="${dao.module.artifact}" />
		<filelist dir="${ejb.module.location}/build" files="${ejb.module.artifact}" />
		<filelist dir="${build.module.location}/lib">
			<file name="org.domainobject.util.jar" />
		</filelist>
	</path>

	<!-- Creates version.properties which is used by the services -->
	<target name="create-version-file" depends="git-info">
		<naturalis:getBuildNumber />
		<propertyfile file="${rest.module.location}/src/main/resources/version.properties"
		              comment="Generated by Ant build">
			<entry key="git.branch" value="${git.branch}" />
			<entry key="git.tag" value="${git.tag}" />
			<entry key="git.commit" value="${git.commit}" />
			<entry key="build.date" type="date" value="now" />
			<entry key="build.number" type="int" value="${build.number}" />
		</propertyfile>
	</target>

	<target name="create-war-file" depends="create-version-file,test">
		<war destfile="build/${rest.module.artifact}" webxml="WebContent/WEB-INF/web.xml">
			<lib dir="WebContent/WEB-INF/lib" />
			<classes dir="build/main" excludes="**/.git*" />
			<fileset dir="WebContent" />
		</war>
	</target>

	<target name="build" depends="build-ejb-module,clean,create-war-file" />

</project>
