<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project xmlns:ivy="antlib:org.apache.ivy.ant" xmlns:if="ant:if" xmlns:unless="ant:unless" basedir="." name="nl.naturalis.nda.service.rest" default="build">

	<import file="../nl.naturalis.nda.build/common.xml" />

	<path id="non-ivy-dependencies">
		<!-- projects that this project depends on -->
		<filelist dir="${nl.naturalis.nda.domain.location}/build" files="nl.naturalis.nda.domain.jar" />
		<filelist dir="${nl.naturalis.nda.elasticsearch.dao.location}/build" files="nl.naturalis.nda.elasticsearch.dao.jar" />
		<filelist dir="${nl.naturalis.nda.ejb.location}/build" files="nl.naturalis.nda.ejb.jar" />
		<!-- libraries not inside this project's lib dir -->
		<filelist dir="${nl.naturalis.nda.build.location}/lib">
			<file name="org.domainobject.util.jar" />
			<file name="org.domainobject.util.debug.jar" />
		</filelist>
	</path>

	<!-- Build projects that this project depends on -->
	<target name="projects">
		<echo message="Building required projects for ${ant.project.name}" />
		<ant antfile="${nl.naturalis.nda.domain.location}/build.xml" useNativeBasedir="true" inheritrefs="true" />
		<ant antfile="${nl.naturalis.nda.elasticsearch.dao.location}/build.xml" useNativeBasedir="true" inheritrefs="true" />
		<ant antfile="${nl.naturalis.nda.ejb.location}/build.xml" useNativeBasedir="true" inheritrefs="true" />
	</target>

	<!-- Export war file, but only if it does not exist already -->
	<target name="build" unless:set="${ant.project.name}.packaged">
		<available file="build/${ant.project.name}.war" property="${ant.project.name}.packaged" />
		<echo if:set="${ant.project.name}.packaged" message="${ant.project.name} already built. Clean project to force rebuild." />
		<echo unless:set="${ant.project.name}.packaged" message="*************** [ Building ${ant.project.name} ] ***************" />
		<antcall target="projects" unless:set="${ant.project.name}.packaged" />
		<antcall target="compile-sources" unless:set="${ant.project.name}.packaged" />
		<war destfile="build/${ant.project.name}.war" webxml="WebContent/WEB-INF/web.xml">
			<lib dir="WebContent/WEB-INF/lib" />
			<classes dir="build/main" excludes="**/.git*" />
			<fileset dir="WebContent" />
		</war>
		<property name="${ant.project.name}.packaged" value="true" />
	</target>

	<target name="rebuild" depends="clean,build" />

</project>
